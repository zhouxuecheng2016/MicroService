# MicroService

微服务主要的优势如下：
1、降低复杂度
将原来偶合在一起的复杂业务拆分为单个服务，规避了原本复杂度无止境的积累。每一个微服务专注于单一功能，
并通过定义良好的接口清晰表述服务边界。每个服务开发者只专注服务本身,通过使用缓存、DAL等各种技术手段来提升系统的性能，
而对于消费方来说完全透明.

2、可独立部署
由于微服务具备独立的运行进程,所以每个微服务可以独立部署.当业务迭代时只需要发布相关服务的迭代即可,
降低了测试的工作量同时也降低了服务发布的风险.

3、容错
在微服务架构下,当某一组件发生故障时,故障会被隔离在单个服务中。
通过限流、熔断等方式降低错误导致的危害,保障核心业务正常运行。

4、扩展
单块架构应用也可以实现横向扩展,就是将整个应用完整的复制到不同的节点。
当应用的不同组件在扩展需求上存在差异时,微服务架构便体现出其灵活性,因为每个服务可以根据实际需求独立进行扩展。

技术选型、通讯协议、服务依赖模式、开始模式、运行模式等
架构师可以根据公司的技术实力并结合项目的特点来选择某个合适的微服务架构平台，
以此稳妥地实施项目的微服务化改造或开发进程。

微服务的核心要素在于服务的发现、注册、路由、熔断、降级、分布式配置，
基于上述几种必要条件对Dubbo和Spring Cloud做出对比。

一、核心部件
Dubbo只是实现了服务治理，而Spring Cloud子项目分别覆盖了微服务架构下的众多部件，
而服务治理只是其中的一个方面。Dubbo提供了各种Filter，对于上述中“无”的要素，可以通过扩展Filter来完善。

例如
1．分布式配置：可以使用淘宝的diamond、百度的disconf来实现分布式配置管理
2．服务跟踪：可以使用京东开源的Hydra，或者扩展Filter用Zippin来做服务跟踪
3．批量任务：可以使用当当开源的Elastic-Job、tbschedule

二、通讯协议
1、Dubbo：dubbo使用RPC通讯协议，提供序列化方式如下：
dubbo：Dubbo缺省协议采用单一长连接和NIO异步通讯，适合于小数据量大并发的服务调用，
       以及服务消费者机器数远大于服务提供者机器数的情况
rmi：RMI协议采用JDK标准的java.rmi.*实现，采用阻塞式短连接和JDK标准序列化方式
Hessian:Hessian协议用于集成Hessian的服务，Hessian底层采用Http通讯，采用Servlet暴露服务，
        Dubbo缺省内嵌Jetty作为服务器实现
http:采用Spring的HttpInvoker实现
2、Spring Cloud：Spring Cloud 使用HTTP协议的REST API

(二)、性能比较
说明：客户端和服务端配置均采用阿里云的ECS服务器，4核8G配置，dubbo采用默认的dubbo协议
点评：dubbo支持各种通信协议，而且消费方和服务方使用长链接方式交互，通信速度上略胜Spring Cloud，
如果对于系统的响应时间有严格要求，长链接更合适。

三、服务依赖方式

四、组件运行流程

Dubbo组件运行流程
gateWay:前置网关，具体业务操作，gateWay通过dubbo提供的负载均衡机制自动完成
Service：原子服务，只提供该业务相关的原子服务
Zookeeper：原子服务注册到zk上

▲Spring Cloud 组件运行
所有请求都统一通过 API 网关（Zuul）来访问内部服务。
网关接收到请求后，从注册中心（Eureka）获取可用服务。
由 Ribbon 进行均衡负载后，分发到后端的具体实例。
微服务之间通过 Feign 进行通信处理业务。

点评：业务部署方式相同，都需要前置一个网关来隔绝外部直接调用原子服务的风险。Dubbo需要自己开发一套API 网关，
而Spring Cloud则可以通过Zuul配置即可完成网关定制。使用方式上Spring Cloud略胜一筹。

五、微服务架构组成以及注意事项

到底使用是dubbo还是Spring Cloud其实并不重要，重点在于如何合理的利用微服务。
下面是一张互联网通用的架构图,其中每个环节都是微服务的核心部分。 

（一）、架构分解
网关集群：数据的聚合、实现对接入客户端的身份认证、防报文重放与防数据篡改、
         功能调用的业务鉴权、响应数据的脱敏、流量与并发控制等
业务集群：一般情况下移动端访问和浏览器访问的网关需要隔离，防止业务耦合
Local Cache：由于客户端访问业务可能需要调用多个服务聚合，所以本地缓存有效的降低了服务调用的频次，
             同时也提示了访问速度。本地缓存一般使用自动过期方式，业务场景中允许有一定的数据延时。
服务层：原子服务层，实现基础的增删改查功能，如果需要依赖其他服务需要在Service层主动调用
Remote Cache：访问DB前置一层分布式缓存，减少DB交互次数，提升系统的TPS
DAL：数据访问层，如果单表数据量过大则需要通过DAL层做数据的分库分表处理。
MQ：消息队列用来解耦服务之间的依赖，异步调用可以通过MQ的方式来执行
数据库主从：服务化过程中毕竟的阶段，用来提升系统的TPS
（二）注意事项

服务启动方式建议使用jar方式启动，启动速度快，更容易监控
缓存、缓存、缓存，系统中能使用缓存的地方尽量使用缓存，通过合理的使用缓存可以有效的提高系统的TPS
服务拆分要合理，尽量避免因服务拆分而导致的服务循环依赖
合理的设置线程池，避免设置过大或者过小导致系统异常






